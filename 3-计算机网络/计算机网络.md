## 	绪论

- 成绩占比
  - `70%` 期末考核
  - `30%` 平时成绩
    - 随堂测验
    - 签到



## 第一章：引言

- 计算机网络定义
  - 多个独立的计算机通过网络连接
  - 通过一套技术在不同系统间交流
- 分类
  - 按规模分类
    - 个人网
    - 局域网
      - 总线网
      - 环型网
    - 广域网
  - 按传输技术分类
    - 广播式
    - 点对点式

### 网络软件

- 协议层次结构
  - 层次栈/分级栈[^ 每一层目的想上一层提供特定的服务，而把如何实现的服务细节对上一层加以屏蔽]
  - 协议[^ 通信双方就如何进行通信的一种约定]
  - 接口[^ 下层向上层提供那些原语操作和服务]
  - 网络体系结构[^ 层和协议的集合]

- 信息的传递需经历层层打包和解包

- 面向连接&无连接的服务
  - 面向连接的服务[^ Eg: 管道专线连接 ]
  - 无连接服务[^ Eg: 邮政式中转分发]



### 参考模型

- 七层OSI参考模型
  1. 物理层：关注一条通信信道上传输原始比特
  
  2. 链路层：将一个原始的传输设施转变成一条没有漏检传输错误的线路
  
  3. 网络层：控制子网的运行
  
  4. 运输层：接受来自上一层的数据，必要时把这些数据分割成较小的单元，

     ​				然把这些数据单元传递给网络层，并且确保这些数据单元正确到达另一端
  
     ​				真正的端到端的层
  
  5. 会话层：允许不同机器上的用户建立会话
  
  6. 表示层：关注所传递信息的语法和语义
  
  7. 应用层：包含了用户通常需要的各种各样的协议
  
- TCP/IP参考模型

  1. 链路层(略)：主机与传输线路之间的一个接口，描述链路需完成什么才能满足无连接的互联网络层的需求

  2. 互联网层：将整个网络体系结构贯穿在一起的关键层

     > IP[^ 定义了官方的数据包格式和协议]，ICMP[^ 因特网控制报文协议]

  3. 传输层：允许源主机和目标主机上的对等实体进行对话

     > TCP[^ 可靠的，面向连接的协议]，UDP[^ 不可靠的，面向无连接的协议]

  4. 应用层：包含所有高层协议

     > TELNET，FTP，SMTP，HTTP

- OSI和TCP/IP参考模型的比较
  - service interface protocol
  - OSI：影响力强概念明晰；被政治局势影响产生
  - TCP/IP：成功且运转良好的协议，并成为标准；实际指导产生的协议，分层模糊易混淆

- Hybird Model[^ 现今在用的模型]

### 网络实例

- Internet
  - 大量网络的集合
  - 使用特定公共协议并提供特定公共服务
  - 前身APRANET：分组交换
- Ethernet
  - 总线式(相对于广播式的传播方式)
  - 小范围
- Wireless Networks

- 网络有影响力的组织
  - ISO[^ 国际标准化组织]，ITU[^ ]，IEEE[^ ]，ETF[^ ]，W3C[^ ]

### 1.9章总结



## 第二章：物理层[^ 比特]

> 物理层<u>**比特**</u> - 链路层<u>帧</u>

### 2.6.5交换

- 电路交换[^ 基于实际端到端物理路径的信息交换]

  > 保证服务，可能浪费资源

- 包交换/分组交换[^ 路由器使用储存-转发技术，由于无固定路径，到达的秩序可能出现混乱]

  > 不保证服务，不会浪费资源

  - 规定数据包的大小：确保不发生霸占传输线路的问题
  - 没为传输数据预留带宽：排队延迟




## 第三章：数据链路层[^ 帧]

> 物理层<u>比特</u> - 链路层**<u>帧</u>** - 网络层<u>包</u>

### 3.1 设计问题

- 主要功能
  - 给网络层提供服务接口
  - 处理传输错误
  - 调节数据流，适应不同速设备不被淹没
- (数据)帧的构成：帧头，有效载荷，帧尾

#### 3.1.1 提供给网络层的服务

- 无确认的无连接：源机器向目标机器发送独立的帧，目标机器并不对这些帧进行确认

  - 特点

    - 不需建立逻辑连接，不用释放逻辑连接
    - 不试图检测丢帧或试图恢复丢失帧

  - 用于错误率低的场合，靠上层恢复；实时通信，延迟比受损更严重

    > Ethernet

- 有确认的无连接：不使用逻辑连接，但每一帧需独立确认

  - 用于不可靠的信道

    > 802.11

- 有确认的有连接：建立逻辑连接，编号每一帧并确认收到

  - 特点
    - 最复杂服务：建立/维护/释放连接，初始化/释放变量和计数器
    - 所有帧只被接收一次，且按照正确顺序接收

#### 3.1.2 成帧[^ 为方便纠错拆分比特流为帧并附上校验]

- 字节计数法[^ 利用头部中的一个字段来表示该帧中字符数]

  - 问题
    - 因一个传输错误而混乱，造成此起后续所有数据无法被正确识别
    - 且接收方无法得知距离开始处多少字节

- 字节填充的标志字节法[^ 用标志字节作为帧的起始和结束分界符]

  - 解决：出错后的重新同步问题：搜索两个标志字节以获取当前帧结尾和下一帧起始

  - 问题
    - 标志字节`FLAG` `ESC`出现在数据中时影响帧的分界
      - 字节填充技术：前面再添加转义字节`ESC`
    - 只能使用8比特的字节

- 比特填充的标志比特法[^ 在比特级完成帧的划分，帧可包含任意大小单元组成的二进制比特数。开始结束由特殊比特模式决定]

  - 用填充比特的方法避免标志比特在内容中出现(标志比特连6个1，则内容每连续5个1补1个0)
  - 解决：只能使用8比特的字节为单元

  > USB

- 物理层编码违禁法(略)

- 差错控制[^ 修复收到的错误]

  > - 要求错误被接收方发现

#### 3.1.3 流量控制[^ 处理不同速设备信息间传输堵塞]

- 基于反馈的流量控制
- 基于速率的流量控制

### 3.2 错误检测和纠错

#### 3.2.1 纠错码

#### 3.2.2 检错码

### 3.3 基本数据链路层协议

#### 3.3.1 乌托邦式的单工协议[^ 不考虑任何出错的情况，仅单向传输]

- 收发双方**总处于准备就绪**状态，数据**处理时间不计**，**可用缓存无穷大**，链路层通信信道**永不损坏帧或丢帧**

```C++
void sender1(void) {
    frame s;
    packet buffer;
    while(true) {
        网络层接收数据储存至buffer;
        转buffer中信息为frame;
        把frame发送给物理层;
    }
}
void recerver1(void) {
    frame r;
    event_type event;
    while(true) {
        等事件触发发生;
        接收并将硬件缓冲区的bit转为frame;
        解析frame转化并传递给网络层;
    }
}
```

#### 3.3.2 无措信道上的单工停-等式协议[^ 考虑接收方可能被高速发送方的帧淹没情况]

- 建立强大接收器
- 接收方传递数据包至网络层后发送反馈信息(哑帧)[^ 仅在一个方向上传输数据]

#### 3.3.3 有错信道上的单工停-等式协议[^ 考虑常规 出错帧 损坏帧 丢失帧情况]

- 能区分到达的帧是首次发来的新帧或是被重传的老帧
- 带有重传的肯定确认`PAR`[^ 仅在一个方向上传输数据]
- 双方链路层处于等待状态时用变量记录下个要发送的帧序号/下个期待帧序号
- 发出方发出一帧后启动/重置计时器，在足够长的计时器到时后确认帧仍未接收到/损坏则重新发送
- 接收方检查接收帧的序号，若非重复数据包则传给网络层并返回确认帧，重复则返回对应确认帧

### 3.4 滑动窗口协议[^ 考虑全双工数据传输]

- 捎带确认：暂时延缓确认以便将确认信息搭载在下一个出境数据帧的技术

- 滑动窗口[^ 任何时刻发送方和接收方总维持一组序号，仅发送/接收窗口序号内的帧]

#### 3.4.1 1位滑动窗口协议[^ 等-停式]

- 发送方在接收到接收方对前一帧的确认到来才能发送下一帧
- frame_expected 仅取值0或1
- 过早超时会使帧多次发送，导致带宽浪费

#### 3.4.2 回退n协议[^ 考虑传输时间]

- 1位滑动窗口在长发送时间、高带宽、短帧情境下会导致极大比例资源由于等待前一帧的确认的堵塞被浪费
- w位窗口
  - $$ w = 2 * 带宽延迟乘积(BD) + 1$$[^ 必须接受完整个帧确认帧才被发出]
  - $$ 链路利用率 \le \frac{w}{1+2BD}$$
- 管道化[^ 保持多个帧同时在传输的技术]：需解决数据流中帧损失后续帧的处理
  - 回退n[^适用于接收窗口大小为1]：接收方简单丢弃所有后续帧并不针对此些返回确认
    - 高信道错误率会浪费大量带宽
  - 选择重传[^ 接收窗口大于1]：丢弃坏帧返回NAK，接收并缓存坏帧后所有好帧返回ACK，等待重传
    - 否认确定(NAK)：可触发发送方对该帧的重传操作
    - 大的窗口需要数据链路层大的内存需求

#### 3.4.3选择重传协议

- 为避免非顺序接收可能的接收方窗口移动，新有效序号范围与老的有重叠导致接收帧混乱情况，

  窗口最大尺寸<= 序号空间/2

- 每个缓冲区均有辅助计时器

## 第四章：介质访问控制子层[^ 数据链路层的子层，处于底部]

- 介质访问控制子层`MAC`：控制多路访问信道下一个使用者的协议

### 4.1 信道分配问题

#### 4.1.1 静态信道分配

- 频分多路复用`FDM`：带宽被等分，用户使用专用频段
- 缺点：无法应对发送方数量多且经常变化、**突发性流量**，资源浪费低效

#### 4.1.2 动态信道分配假设

- 假设基础：流量独立，担心到，冲突可观察，时间连续或分槽，载波侦听或不停

### 4.2 多路访问协议

#### 4.2.1 ALOHA

- 纯ALOHA[^ 时间是连续的]
  - 用户有数据需要发送时就传输
  - 中央计算机广播发送站发来的帧，发送站可侦听帧是否发生冲突
  - 但凡发生两个帧在相同时间占用信道，冲突发生且二帧损坏，发送方随机等待再重发送
  - 竞争系统：多用户共享同一个信道的方法会导致冲突的系统
- 分槽ALOHA[^ 时间分成离散槽]
  - 将时间分成离散的间隔，每个时间槽对应于一帧，用户仅能在下一个时槽的开始时刻传输
  - 测试帧所在同一个时间槽没有其他流量的概率是$$S=Ge^{-G}$$ G:每包时的尝试次数，S:每帧吞吐量
  - 信道负载的微小增长会极大降低信道的性能
  - 信道利用率最大1/e

#### 4.2.2 载波侦听多路访问协议

- 载波侦听协议：站监听是否存在载波(传输)并采取相应的动作

- 坚持和非坚持CSMA

  - 坚持CSMA `1-persistent CSMA` [^ 发现信道空闲时，传输数据的概率为1]

    - 发送数据前**监听信道**使用情况
    - 信道空闲则发送数据
    - 信道忙则等待直至信道空闲
    - 冲突则随即等待时长重复上述

    - 问题
      - 两站等待前一站发完后同时开始传输导致冲突
      - 一站信号延迟传播未达时，对面站认为信道为空开始传输导致冲突
      - 带宽延迟积[^ 信道上适合的帧数] 大则影响越大
  - 非坚持CSMA `nonpersistent CSMA`[^ 较1-CSMA利用率提高，代价延迟更高]

    - 发送数据前**监听信道**使用情况
    - 信道空闲则发送数据
    - 信道忙则**暂停监听**随机时间并重复上述

  - p坚持CSMA `p-persistent CSMA`[^ 发现信道空闲时，传输数据的概率为p]

    - 发送数据前**监听信道**使用情况
    - 信道空闲则**p概率**发送数据，**1-p概率**推迟下一个时间槽发送
    - 信道忙则等待下时间槽重复上述

- 带冲突检测的CSMA `CSMA/CD`[^ 每个站快速检测发生冲突后立即停止传输帧，节省时间和带宽]

  - 冲突检测是一个模拟过程

  - 检测要求接收信号相比发射信号不能太微弱&选择能被检测到冲突的调制解调技术

  - 模型由竞争期[^ 发生冲突]、传输期[^ 正常传输]、空闲期[^ 没有传输任务]组成

  - 检测是否发生冲突的最小等待时间：$$2\tau$$

  - 与分槽ALOHA的区别：只有一个站能用来传输的时间槽后面紧跟的时间槽被用来传输该帧的其余部分，

    若帧时比传播时间长很多，此协议性能优势越大


#### 4.2.3 无冲突协议

- 位图协议
- 令牌传递
- 二进制倒计数

#### 4.2.5 无线局域网协议

- CSMA
  - 问题：未考虑无线传输特性，冲突发生在接收方
    - 隐藏终端问题：竞争者离得太远导致无法检测到潜在的竞争者，发送者检测不到视野外与目标通信的
    - 暴露终端问题：非竞争者将另目标不同的终端检测为竞争者而产生传输延迟
    - 原因：有线情形同一时刻仅能有一个传输在进行；无线情形允许多个传输同时发生
- 冲突避免多路访问`MACA`
  - 基本思想：发送方刺激接收方输出一个短帧，以便其附近的站能检测到该次传输
  - 流程
    - 发送方给接收方发送RTS帧，包括数据帧长度
    - 接收方接收到RTS帧用CTS作应答，包括RTS中的数据帧长度
    - RTS和使非目标接收方保持沉默足够长保证CTS被无冲接受，此后可自由发送
    - CTS和使非目标接收方保持沉默直到传输结束再进行传输，通过其中数据帧的长度得知传输进度 

### 4.3 以太网[^ 实际系统应用]

#### 4.3.1 经典以太网物理层

- 多台计算机通过长电缆上的接口电缆相连
- 速率10Mbps
- 计算机使用以太网协议通信
- CSMA/CD调度传输

#### 4.3.2 经典以太网MAC子层协议

|       8       |    6     |   6    |  2   | 0-1500 | 0-46 |   4    |
| :-----------: | :------: | :----: | :--: | :----: | :--: | :----: |
| 前导码+定界符 | 目标地址 | 源地址 | 类型 |  数据  | 填充 | 校验和 |

- 前导码：同步时钟，SOF定界符告知即将开始帧
- 目标地址：第一位为0表示普通地址；为1表示组地址，允许对应的多站监听；全1表示广播
- 填充：保证最小帧长以获得可靠检测，避免：
  - 一个短帧没到达电缆远端的发送方，该帧的传输已经结束，电缆的远端，该帧与零一阵发生冲突
  - 导致发送方误认为冲突消息被正确接收

#### 4.3.3 以太网系性能		

- 帧长越长，效率越高

#### 4.3.4 交换式以太网[^ 解决单根电缆断裂或者松动位置连接相关问题]

- 中央集线器：电气上简单连接所有连接线
  - 使用现有布线，易于维护；不能增加容量
  - 唯一的冲突域使用CSMA/CD算法调度各自站的传输
- 交换机：把帧输出到想去的端口
  - 每个端口拥有独立的冲突域，由于电缆的双全工，站和端口可同时往电缆上发送帧
  - 冲突**不可能发生**
  - **容量**的使用较上者更为有效
  - **缓冲队列**的引入解决了多帧前往相同目标相同的问题
  - 由于上述，**性能**较上者提升较大
  - 流量只被转发至目标端口以隔离数据，**安全性**上升

#### 4.3.5-7 快速以太网-万兆以太网

- 快速以太网[^ 带宽增至100Mbps]
  - 保留原来的帧格式、接口、过程规则，降低比特时间100ns->10ns
  - 5类双绞线在市场中广为使用
- 千兆以太网

### 4.4 无线局域网

#### 4.4.1 802.11体系结构和协议栈

#### 4.4.4、

### 4.8 数据链路层交换

- 网桥[^ 把多个局域网连结起来组成更大的局域网的设备，也成为交换机]

#### 4.8.1 网桥的使用

#### 4.8.2 学习网桥

- 后向学习法

#### 4.8.4 



## 第五章：网络层[^ 包]

>  链路层<u>帧</u> - 网络层**<u>包</u>** - 传输层

### 5.1 网络层的设计问题

#### 5.1.1 储存转发数据包交换

- 组件：网络服务提供商ISP的设备[^ 通过传输线路连接的路由器]，客户端设备
- 储存-转发数据包交换：主机 - 路由器(完成校验和验证) - 转发到下一个路由器 - 目标主机

#### 5.1.2 提供给传输层的服务

- 目标：传输层只关心可不可达
  - 向上提供的服务独立于路由器技术
  - 向传输层屏蔽路由器数量、类型和拓扑关系
  - 传输层可用的网络地址应有可跨越LAN WAN的统一编址方案
- Internet正向面向连接的特性进化

#### 5.1.3 无连接服务的实现

- 数据报(datagram)和数据报网络(datagram network)
- 过程
  - 拆分消息成数据包以适应最大数据包长度
  - 使用点到点协议发送数据包给最近的路由器
  - 路由器暂存经过校验和验证的入境数据包
  - 路由器根据**路由算法**[^ 管理路由表并做出路由选择的算法]将装入新帧的数据包转发给下一个路由器
  - 重复上一步直到目标
- **每个包的路由传输路径可能有不同**
- 每个路由器的内部表指明了目标地址和所用出境线路
- IP协议[^ 整个Internet的基础]：每个数据包携带一个目标IP，路由器使用该地址单独转发每一个数据包

#### 5.1.4 面向连接服务的实现

- 虚电路(VC)和虚电路网络(virtual-circuit network)[^ 避免为每一个要发送的数据包选择一条新路经]
- 过程
  - 建立连接
  - 严格**按照路径**路由传输
  - 连接释放，虚电路消失
- 虚电路于建立连接时确定下来
- 数据包包含标识符表明虚电路归属
- 路由器的内部表记录了连接标识符[^ 避免冲突]和数据来源
- 多协议标签交换[^ 替换出境数据包中连接标识符]
  - ISP用其为超大流量建立长期链接
  - 用于高质量服务和协助ISP流量管理

#### 5.1.5 虚电路与数据报网络的比较

|           问题 |          数据报网络          |                虚电路网络                |
| -------------: | :--------------------------: | :--------------------------------------: |
|       电路建立 |            不需要            |                   需要                   |
|           寻址 | 每个包包含全部的源和目标地址 |            每个包包含简短VC号            |
|       状态信息 |     路由器不保留连接状态     |     每个连接每个VC都需路由器保存状态     |
|       路由方式 |     每个数据包被单独路由     |    建立VC时选择路由，所有包遵循该路由    |
| 路由器失效影响 |   无影响，除崩溃时丢失的包   |        穿过故障路由的所有VC均中断        |
|       服务质量 |             困难             | 容易，预先建立在每条VC时有足够资源可分配 |
|       阻塞控制 |             困难             | 容易，预先建立在每条VC时有足够资源可分配 |

### 5.2 路由算法[^ 确定一个入境数据包应该被发送到哪一条输出线路上]

- 路由[^ 对哪一条路径做出决策，生成和更新路由表]
- 转发[^ 一个数据包到达时该采取什么动作，路由表中查找数据包对应的出境线路]
- ...

#### 5.2.1 优化原则

- 最优化原则：
- 汇集树

#### 5.2.2 最短路径算法 Dijkstra

#### 5.2.3 泛洪算法 flooding

- 将每一个入境数据包发送到除了该数据包到达的那条线路意外的每条出境线路
- 不足
  - 产生大量重复数据表

#### 5.2.4 距离矢量算法 distance vector routing

- 算法
  - 每个路由器维护一张表(一个矢量)，其中列出已知的最佳距离和使用链路
  - 表通过邻居间相互交换消息不断更新
  -  

#### 5.2.5 链路状态路由 link state routing

- 发现邻居
- 设置链路成本
- 分发链路状态包
- 计算新路由

#### 5.2.6 层次路由

### 5.3 拥塞控制算法

- 拥塞：网络中存在的**太多的数据包**导致数据包被**延迟**，被**丢失**，从而降低了传输性能的现象
- 减少拥塞最有效方式是减少传输层注入网络的负载，需网络层和传输层共同努力协同工作
- 拥塞崩溃

#### 5.3.1 拥塞控制的途径

#### 5.3.2 流量感知路由

#### 5.3.3 
