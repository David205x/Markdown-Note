# L5 系统调用的实现

## 内核态 用户态 内核段 用户段
- 态：正在执行的程序本身的属性；段：内存的一段区域，程序正在运行的位置
- 内核态的程序执行在内核段下，用户态的程序不能随意跳进内核段
- 区分内核态和用户态：通过处理器的硬件设计
- 程序状态与特权级：`CS:IP`表当前指令，以`CS`的最低两位表示程序的特权级：0为内核态，3是用户态，中间还有1,2两段，不关注
  - `DPL`：将到达地址空间（目的地）的特权级
  - `CPL`：当前程序的特权级
  - 每次访问时（如`mov`，`jmp`）：**硬件**比较`CPL`和`DPL`，判断有无权限继续操作，若`CPL`>`DPL`则权限不足

!!! tip 考点
    判断是否有权限进入，别被比大小绕晕了，从`CPL`到`DPL`，小值到大值可以

## 主动进入内核的方法
- 对x86，使用中断指令`int` = 0x80，先将`DPL`设为3以允许进入内核，再将`CPL`改为0
- `int`是系统调用进入内核段的**唯一途径**
- 系统调用的核心
  1. 用户程序中将系统调用号存入`eax`寄存器，使用系统中断`int`指令
  2. 操作系统写中断处理，根据`eax`获取想调的内核函数
  3. 操作系统执行内核函数
