# L22多级页表与快表
### 矛盾
- 为提高内存空间利用率，页应该小，导致页表太大
- 大部分逻辑地址用不到：程序中会使用的逻辑地址较少，有些页号不需要对应物理页号，导致页表中的一些项没有用
##### 只存放用到的页
- 用到的逻辑页才有页表项
- 页号不连续，导致每次寻址都要访问内存，再在页表中逐项查找
##### 页号连续
- 32位地址空间(4G) 4K页大小 页号连续 -> 2^20个页表项，太大

### 多级页表
- 页目录表+页表
- 页目录和页表都连续，即使对应位置没有映射，也存储对应项
- 不存在的页表不存储，避免浪费内存
- 一个页目录对应4K * 4K = 4M地址空间
- 空间效率高，但是用内存访存次数换空间效率
- 10bits页目录号，10bits页号，12bits Offset
```
  对一个所有段加起来一共需要10M的程序
  向上取值它只需要3个页表就可以了
```

### 快表
- TLB：一组相联快速储存，是寄存器，维护常用的页表项
- 每次先在TLB中查找：
  - TLB命中则直接能获得物理页框号
  - TLB未命中则去多级页表从头查找
- $有效访问时间 = HitR \times (TLB+MA) + (1-HitR) \times (TLB+2MA)$
  - $HitR$:TLB命中率
  - $TLB$:TLB时间
  - $MA$:内存访问时间
- TLB命中率是核心影响因素
##### 为什么TLB能起作用
- 程序的地址访问有局部性：顺序、循环结构